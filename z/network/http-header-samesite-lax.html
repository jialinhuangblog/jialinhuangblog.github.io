<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>HTTP Headers: Set-Cookie - SameSite Configuration</title></head><body><article class="page serif"><header><h1 class="page-title">HTTP Headers: Set-Cookie - SameSite Configuration</h1><p class="page-description"></p><table class="properties"><tbody><tr class="property-row property-row-created_by"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesCreatedBy"><path d="M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM8 10.4229C6.05176 10.4229 4.54785 11.1133 3.83008 11.9131C2.90039 10.9082 2.33301 9.55469 2.33301 8.06445C2.33301 4.91992 4.84863 2.39746 7.99316 2.39746C11.1377 2.39746 13.6738 4.91992 13.6738 8.06445C13.6738 9.55469 13.1064 10.9082 12.1699 11.9131C11.4521 11.1133 9.94824 10.4229 8 10.4229ZM8 9.30176C9.32617 9.30859 10.3516 8.18066 10.3516 6.71094C10.3516 5.33008 9.31934 4.18164 8 4.18164C6.6875 4.18164 5.6416 5.33008 5.64844 6.71094C5.65527 8.18066 6.68066 9.28809 8 9.30176Z"></path></svg></span>Created by</th><td><span class="user"><img src="HTTP%20Headers%20Set-Cookie%20-%20SameSite%20Configuration%201066cd51990d80ba9807d5d3f35ce45b/IMG_2295.jpg" class="icon user-icon"/>JiaLin Huang</span></td></tr><tr class="property-row property-row-last_edited_time"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesCreatedAt"><path d="M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM8 13.7383C4.85547 13.7383 2.33301 11.209 2.33301 8.06445C2.33301 4.91992 4.84863 2.39746 7.99316 2.39746C11.1377 2.39746 13.6738 4.91992 13.6738 8.06445C13.6738 11.209 11.1445 13.7383 8 13.7383ZM4.54102 8.91211H7.99316C8.30078 8.91211 8.54004 8.67285 8.54004 8.37207V3.8877C8.54004 3.58691 8.30078 3.34766 7.99316 3.34766C7.69238 3.34766 7.45312 3.58691 7.45312 3.8877V7.83203H4.54102C4.2334 7.83203 4.00098 8.06445 4.00098 8.37207C4.00098 8.67285 4.2334 8.91211 4.54102 8.91211Z"></path></svg></span>Last edited</th><td><time>@2024年9月19日 20:47</time></td></tr><tr class="property-row property-row-multi_select"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesMultipleSelect"><path d="M1.91602 4.83789C2.44238 4.83789 2.87305 4.40723 2.87305 3.87402C2.87305 3.34766 2.44238 2.91699 1.91602 2.91699C1.38281 2.91699 0.952148 3.34766 0.952148 3.87402C0.952148 4.40723 1.38281 4.83789 1.91602 4.83789ZM5.1084 4.52344H14.3984C14.7607 4.52344 15.0479 4.23633 15.0479 3.87402C15.0479 3.51172 14.7607 3.22461 14.3984 3.22461H5.1084C4.74609 3.22461 4.45898 3.51172 4.45898 3.87402C4.45898 4.23633 4.74609 4.52344 5.1084 4.52344ZM1.91602 9.03516C2.44238 9.03516 2.87305 8.60449 2.87305 8.07129C2.87305 7.54492 2.44238 7.11426 1.91602 7.11426C1.38281 7.11426 0.952148 7.54492 0.952148 8.07129C0.952148 8.60449 1.38281 9.03516 1.91602 9.03516ZM5.1084 8.7207H14.3984C14.7607 8.7207 15.0479 8.43359 15.0479 8.07129C15.0479 7.70898 14.7607 7.42188 14.3984 7.42188H5.1084C4.74609 7.42188 4.45898 7.70898 4.45898 8.07129C4.45898 8.43359 4.74609 8.7207 5.1084 8.7207ZM1.91602 13.2324C2.44238 13.2324 2.87305 12.8018 2.87305 12.2686C2.87305 11.7422 2.44238 11.3115 1.91602 11.3115C1.38281 11.3115 0.952148 11.7422 0.952148 12.2686C0.952148 12.8018 1.38281 13.2324 1.91602 13.2324ZM5.1084 12.918H14.3984C14.7607 12.918 15.0479 12.6309 15.0479 12.2686C15.0479 11.9062 14.7607 11.6191 14.3984 11.6191H5.1084C4.74609 11.6191 4.45898 11.9062 4.45898 12.2686C4.45898 12.6309 4.74609 12.918 5.1084 12.918Z"></path></svg></span>Tags</th><td><span class="selected-value select-value-color-purple">Post</span></td></tr></tbody></table></header><div class="page-body"><p class="">
</p><h1 class="">Why</h1><p class="">The issue arose when cookies obtained after logging in at <code>localhost:3000</code> couldn&#x27;t be used at <code>thembase-subdomain.localhost:3000</code>. </p><p class="">The solution involves using these cookie options:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-JavaScript"> cookieOptions: {
    httpOnly: true,
    secure: false,
    sameSite: &quot;lax&quot;,
    path: &quot;/&quot;,
  },</code></pre><p class="">
</p><h1 class="">SameSite Values…</h1><p class="">SameSite has three possible values: <strong>strict, lax, and none.</strong></p><ol type="1" class="numbered-list" start="1"><li><strong>Strict:</strong> Completely prohibits third-party use. For example, if used by Yahoo, Facebook wouldn&#x27;t receive it.</li></ol><ol type="1" class="numbered-list" start="2"><li><strong>Lax:</strong> Allows some third-party use, particularly for top-level navigation.</li></ol><ol type="1" class="numbered-list" start="3"><li><strong>None:</strong> Allows third-party use but must be paired with the Secure flag.</li></ol><p class="">
</p><h1 class="">Same Site vs Same Origin</h1><h3 class="">Same Site (main topic of this article)</h3><ol type="1" class="numbered-list" start="1"><li>eTLD+1 rule:<ul class="bulleted-list"><li style="list-style-type:disc">Generally, same site refers to sharing the same eTLD+1 (effective Top-Level Domain plus one level).</li></ul><ul class="bulleted-list"><li style="list-style-type:disc">For example, <code>example.com</code>, <code>www.example.com</code>, and <code>blog.example.com</code> are all considered the same site.</li></ul><ul class="bulleted-list"><li style="list-style-type:disc"><code>www.web.dev</code> and <code>static.web.dev</code> are the same site, belonging to web.dev (also known as &quot;<strong>subdomain private</strong>&quot;).<p class=""><a href="https://web.dev/articles/samesite-cookies-explained">https://web.dev/articles/samesite-cookies-explained</a></p></li></ul></li></ol><ol type="1" class="numbered-list" start="2"><li>Public Suffix List exceptions:<p class=""><a href="https://publicsuffix.org/">https://publicsuffix.org/</a></p><ul class="bulleted-list"><li style="list-style-type:disc">Some domains (like <code>github.io</code>, <code>herokuapp.com</code>) are on the public suffix list, and <mark class="highlight-red"><strong>their subdomains are treated as separate sites.</strong></mark></li></ul><ul class="bulleted-list"><li style="list-style-type:disc">For instance, <code>youraccount.github.io</code> and <code>myaccount.github.io</code> are not considered the same site.</li></ul></li></ol><ol type="1" class="numbered-list" start="3"><li>Protocol and port: For SameSite cookies, protocol (http/https) and port usually don&#x27;t affect the &quot;same site&quot; determination.</li></ol><ol type="1" class="numbered-list" start="4"><li>IP addresses: When using IP addresses directly, each IP is considered a separate site.</li></ol><ol type="1" class="numbered-list" start="5"><li>Localhost: <code>localhost</code> is typically viewed as one site, and its subdomains (like <code>test.localhost</code>) might be considered the same site, but this can vary by browser implementation.</li></ol><p class="">
</p><h3 class="">Same Origin (important in other places, but not this article)</h3><ul class="bulleted-list"><li style="list-style-type:disc">Same Origin policy requires the <mark class="highlight-red"><strong>scheme (protocol), host, and port to be identical</strong></mark>.</li></ul><ul class="bulleted-list"><li style="list-style-type:disc">Under this definition, <code>www.web.dev</code> and <code>static.web.dev</code> are not considered the same origin due to different subdomains.</li></ul><p class="">
</p><p class="">
</p><p class="">
</p><p class="">
</p><p class="">
</p><p class="">
</p><h1 class="">Top-level Navigation with SameSite=Lax</h1><p class="">Top-level Navigation refers to </p><ol type="1" class="numbered-list" start="1"><li>directly entering a URL in the browser&#x27;s address bar</li></ol><ol type="1" class="numbered-list" start="2"><li>clicking a link that causes a page transition.</li></ol><p class="">When SameSite is set to Lax, it allows cookies to be sent during top-level navigation (like clicking links), but not for sub-resource requests like <code>img</code> or <code>iframe</code>.</p><p class=""><br/><br/><a href="https://stackoverflow.com/questions/67689503/what-is-top-level-navigation-in-browser-terminology-and-in-what-ways-it-can-be-t">https://stackoverflow.com/questions/67689503/what-is-top-level-navigation-in-browser-terminology-and-in-what-ways-it-can-be-t</a></p><blockquote class="">Basically, TOP LEVEL navigation changes the URL in your address bar. Resources that are loaded by iframe, img tags, and script tags do not change the URL in the address bar so none of them cause TOP LEVEL navigation.</blockquote><p class="">
</p><p class="">
</p><p class="">
</p><p class="">
</p><h1 class="">Top-level Navigation with SameSite=Strict</h1><p class="">Strict mode provides the <mark class="highlight-red"><strong>strongest protection against CSRF</strong></mark> (Cross-Site Request Forgery) attacks by not sending cookies to different sites, even for top-level navigation.</p><p class="">
</p><p class="">
</p><p class="">
</p><h1 class="">Why HttpOnly Can Prevent XSS?</h1><p class=""><code>Set-Cookie: key=value; Expires=...; </code><code><strong>Secure; HttpOnly</strong></code></p><p class="">HttpOnly tells the browser that this cookie <mark class="highlight-red"><strong>cannot be accessed by client-side scripts (like JavaScript).</strong></mark> This helps prevent XSS (Cross-Site Scripting) attacks by ensuring that even if an attacker injects malicious scripts, they can&#x27;t access the cookie.</p><p class="">
</p><p class=""><mark class="highlight-red"><strong>This is restricted.</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-JavaScript">document.cookies()</code></pre><p class="">
</p><p class="">
</p><h1 class="">SameSite=None Must Be Paired with Secure</h1><p class=""><code>Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; SameSite=None; Secure</code></p><p class="">When a cookie is set with <code>SameSite=None</code>, it&#x27;s completely open for cross-site sending. Requiring the Secure flag ensures that these cookies are only sent over HTTPS connections, <mark class="highlight-red"><strong>providing a basic level of security</strong></mark>.</p><p class="">
</p><p class=""><a href="https://developers.google.com/search/blog/2020/01/get-ready-for-new-samesitenone-secure">https://developers.google.com/search/blog/2020/01/get-ready-for-new-samesitenone-secure</a></p><blockquote class="">When the <code>SameSite=None</code> attribute is present, an additional <mark class="highlight-red"><strong>Secure</strong></mark><strong> attribute</strong> must be used so cross-site cookies can only be accessed over HTTPS connections.</blockquote><p class="">
</p><p class="">
</p><h1 class="">Resources</h1><p class=""><a href="https://medium.com/程式猿吃香蕉/再探同源政策-談-samesite-設定對-cookie-的影響與注意事項-6195d10d4441">https://medium.com/程式猿吃香蕉/再探同源政策-談-samesite-設定對-cookie-的影響與注意事項-6195d10d4441</a></p><p class=""><a href="https://developers.google.com/search/blog/2020/01/get-ready-for-new-samesitenone-secure?hl=zh-tw">https://developers.google.com/search/blog/2020/01/get-ready-for-new-samesitenone-secure?hl=zh-tw</a></p><p class=""><a href="https://jsweibo.github.io/2019/03/25/什么是Public-Suffix-List/">https://jsweibo.github.io/2019/03/25/什么是Public-Suffix-List/</a></p><p class=""><a href="https://publicsuffix.org/">https://publicsuffix.org/</a></p><p class=""><a href="https://publicsuffix.org/list/public_suffix_list.dat">https://publicsuffix.org/list/public_suffix_list.dat</a></p><p class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body>