<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Behind the Scenes: Anycast and Its Impact on CDNs</title></head><body><article class="page serif"><header><h1 class="page-title"><strong>Behind the Scenes: Anycast and Its Impact on CDNs</strong></h1><p class="page-description"></p><table class="properties"><tbody><tr class="property-row property-row-created_by"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesCreatedBy"><path d="M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM8 10.4229C6.05176 10.4229 4.54785 11.1133 3.83008 11.9131C2.90039 10.9082 2.33301 9.55469 2.33301 8.06445C2.33301 4.91992 4.84863 2.39746 7.99316 2.39746C11.1377 2.39746 13.6738 4.91992 13.6738 8.06445C13.6738 9.55469 13.1064 10.9082 12.1699 11.9131C11.4521 11.1133 9.94824 10.4229 8 10.4229ZM8 9.30176C9.32617 9.30859 10.3516 8.18066 10.3516 6.71094C10.3516 5.33008 9.31934 4.18164 8 4.18164C6.6875 4.18164 5.6416 5.33008 5.64844 6.71094C5.65527 8.18066 6.68066 9.28809 8 9.30176Z"></path></svg></span>Created by</th><td><span class="user"><img src="Behind%20the%20Scenes%20Anycast%20and%20Its%20Impact%20on%20CDNs%201186cd51990d8059a510dcc426252591/IMG_2295.jpg" class="icon user-icon"/>JiaLin Huang</span></td></tr><tr class="property-row property-row-last_edited_time"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesCreatedAt"><path d="M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM8 13.7383C4.85547 13.7383 2.33301 11.209 2.33301 8.06445C2.33301 4.91992 4.84863 2.39746 7.99316 2.39746C11.1377 2.39746 13.6738 4.91992 13.6738 8.06445C13.6738 11.209 11.1445 13.7383 8 13.7383ZM4.54102 8.91211H7.99316C8.30078 8.91211 8.54004 8.67285 8.54004 8.37207V3.8877C8.54004 3.58691 8.30078 3.34766 7.99316 3.34766C7.69238 3.34766 7.45312 3.58691 7.45312 3.8877V7.83203H4.54102C4.2334 7.83203 4.00098 8.06445 4.00098 8.37207C4.00098 8.67285 4.2334 8.91211 4.54102 8.91211Z"></path></svg></span>Last edited</th><td><time>@2024年10月8日 23:03</time></td></tr><tr class="property-row property-row-multi_select"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesMultipleSelect"><path d="M1.91602 4.83789C2.44238 4.83789 2.87305 4.40723 2.87305 3.87402C2.87305 3.34766 2.44238 2.91699 1.91602 2.91699C1.38281 2.91699 0.952148 3.34766 0.952148 3.87402C0.952148 4.40723 1.38281 4.83789 1.91602 4.83789ZM5.1084 4.52344H14.3984C14.7607 4.52344 15.0479 4.23633 15.0479 3.87402C15.0479 3.51172 14.7607 3.22461 14.3984 3.22461H5.1084C4.74609 3.22461 4.45898 3.51172 4.45898 3.87402C4.45898 4.23633 4.74609 4.52344 5.1084 4.52344ZM1.91602 9.03516C2.44238 9.03516 2.87305 8.60449 2.87305 8.07129C2.87305 7.54492 2.44238 7.11426 1.91602 7.11426C1.38281 7.11426 0.952148 7.54492 0.952148 8.07129C0.952148 8.60449 1.38281 9.03516 1.91602 9.03516ZM5.1084 8.7207H14.3984C14.7607 8.7207 15.0479 8.43359 15.0479 8.07129C15.0479 7.70898 14.7607 7.42188 14.3984 7.42188H5.1084C4.74609 7.42188 4.45898 7.70898 4.45898 8.07129C4.45898 8.43359 4.74609 8.7207 5.1084 8.7207ZM1.91602 13.2324C2.44238 13.2324 2.87305 12.8018 2.87305 12.2686C2.87305 11.7422 2.44238 11.3115 1.91602 11.3115C1.38281 11.3115 0.952148 11.7422 0.952148 12.2686C0.952148 12.8018 1.38281 13.2324 1.91602 13.2324ZM5.1084 12.918H14.3984C14.7607 12.918 15.0479 12.6309 15.0479 12.2686C15.0479 11.9062 14.7607 11.6191 14.3984 11.6191H5.1084C4.74609 11.6191 4.45898 11.9062 4.45898 12.2686C4.45898 12.6309 4.74609 12.918 5.1084 12.918Z"></path></svg></span>Tags</th><td><span class="selected-value select-value-color-purple">Post</span></td></tr></tbody></table></header><div class="page-body"><p class="">When looking into content delivery solutions offered by major companies like Cloudflare, Amazon CloudFront, and Google Cloud CDN, you&#x27;ll find they all provide similar content delivery network services and website security features. Let&#x27;s dive into how these systems work and why they&#x27;re important.</p><p class="">
</p><h1 class="">Why CDN is Important?</h1><p class="">Because it serves content from the <strong>nearest</strong> server to the user. </p><p class="">For example, when you request a script that&#x27;s replicated across multiple geographic locations, you&#x27;ll receive it from the closest server, resulting in faster delivery times. This makes perfect sense, right?</p><p class="">
</p><h1 class="">How Does Content Delivery Work Behind the Scenes?</h1><p class=""><strong>Anycast</strong> technology.</p><p class=""><strong>But first, we need to understand the default unicast.</strong></p><p class="">
</p><h1 class="">The Default — Unicast</h1><p class="">In the world of networking, most of our intuitions are based on Unicast - the standard way of routing where each device has a unique IP address. This is what we&#x27;re used to:</p><ul class="bulleted-list"><li style="list-style-type:disc">One IP address corresponds to one device</li></ul><ul class="bulleted-list"><li style="list-style-type:disc">If two devices have the same IP, it creates conflicts</li></ul><ul class="bulleted-list"><li style="list-style-type:disc">It&#x27;s like each house having a unique postal address</li></ul><p class=""><mark class="highlight-blue"><strong>This Unicast mindset is why many find Anycast confusing at first - it seems to break these fundamental rules we&#x27;ve internalized.</strong></mark></p><h1 class="">Anycast — Breaking the Unicast Paradigm</h1><p class=""><strong>Anycast allows multiple servers to use the same IP address. </strong></p><p class="">Here&#x27;s how it works:</p><ul class="bulleted-list"><li style="list-style-type:disc">Multiple servers (or data centers) in different geographical locations announce the same IP address</li></ul><ul class="bulleted-list"><li style="list-style-type:disc">When a request is sent to this IP address, routers direct it to the &quot;nearest&quot; server</li></ul><ul class="bulleted-list"><li style="list-style-type:disc">The &quot;chosen one&quot; is typically determined based on network topology rather than actual geographical distance</li></ul><p class="">Anycast is made possible by BGP (Border Gateway Protocol) ⬇️</p><p class="">
</p><p class=""><strong>That’s why Anycast is needed when discussing CDNs.</strong></p><p class="">When you type &quot;1.1.1.1&quot; (Cloudflare&#x27;s DNS service) into your browser, your request might hit different physical servers depending on your location. But to you, it&#x27;s all just &quot;1.1.1.1&quot; - simple and fast!</p><p class="">
</p><p class="">
</p><h1 class=""><strong>BGP and Anycast: A Perfect Partnership for Efficient Routing</strong></h1><p class="">Anycast is an implementation abstracted on top of BGP. </p><h3 class="">A real-world analogy</h3><p class=""><mark class="highlight-red">Imagine routers as people on the street, each with different levels of knowledge about the city. BGP is like their method of learning and deciding &quot;how should I go&quot; - considering not just geography, but also factors like traffic congestion.</mark></p><h3 class="">Key points</h3><ol type="1" class="numbered-list" start="1"><li><strong>Announcement</strong>: Anycast nodes use BGP to tell these &quot;street people&quot; (routers): &quot;Hey, we&#x27;re all using the same address!&quot;</li></ol><ol type="1" class="numbered-list" start="2"><li><strong>Learning Process</strong><ol type="a" class="numbered-list" start="1"><li>Not every router needs to learn BGP. If you&#x27;re a &quot;person&quot; who never leaves home (like a home router), you don&#x27;t need to learn these complex routes</li></ol><ol type="a" class="numbered-list" start="2"><li>BGP knowledge is not a mandatory skill for all routers</li></ol><table class="simple-table"><tbody><tr><td class=""><strong>features</strong></td><td class=""><strong>Core Routers</strong></td><td class=""><strong>Edge Routers</strong></td><td class=""><strong>Access Routers</strong></td></tr><tr><td class=""><strong>need learn BGP</strong></td><td class="">yes</td><td class="">yes</td><td class="">no</td></tr><tr><td class=""><strong>examples</strong></td><td class="">Routers between ISPs</td><td class="">Enterprise gateway routers</td><td class="">Home routers, small office routers</td></tr><tr><td class=""><strong>with</strong></td><td class="">Internal: IGP (OSPF, IS-IS), External: BGP</td><td class="">Internal: OSPF, External: BGP</td><td class="">DHCP is enough</td></tr></tbody></table></li></ol><ol type="1" class="numbered-list" start="3"><li><strong>Decision Making</strong>: When traffic arrives, BGP-savvy routers can direct it to the &quot;best&quot; Anycast node based on:<ul class="bulleted-list"><li style="list-style-type:disc">traffic (like avoiding rush hour traffic)</li></ul><ul class="bulleted-list"><li style="list-style-type:disc">Number of hops (like the number of turns in your route)</li></ul><ul class="bulleted-list"><li style="list-style-type:disc">Various routing policies (some paths might be preferred over others)</li></ul></li></ol><p class="">
</p><h3 class=""><strong>A typical flow looks like this</strong></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">User Request ➡️
Local ISP Router (Doesn&#x27;t know BGP) ➡️
BGP-enabled Router (Knows the best path) ➡️
Chosen Anycast Node</code></pre><p class="">
</p><p class="">
</p><p class="">
</p><h1 class="">Google Cloud Load Balancer vs Anycast</h1><p class="">Google Cloud Platform&#x27;s (GCP) load balancer uses a global IP address, which might seem similar to Anycast but isn&#x27;t quite the same. Instead of being a true Anycast IP, it&#x27;s a <strong>Virtual IP (VIP)</strong> managed by Google&#x27;s global network infrastructure.</p><p class="">
</p><p class="">Here&#x27;s how it works:</p><ol type="1" class="numbered-list" start="1"><li>Requests first reach the nearest Google edge location</li></ol><ol type="1" class="numbered-list" start="2"><li>They&#x27;re then routed within Google&#x27;s private network to appropriate load balancers</li></ol><ol type="1" class="numbered-list" start="3"><li>Load balancers distribute traffic to different regions based on factors like user location and backend health</li></ol><p class="">
</p><p class=""><strong>Important Note: </strong><mark class="highlight-blue"><strong>GCP&#x27;s routing decisions aren&#x27;t solely determined by Internet routing protocols. Think of it as having its own specialized BGP-like logic that goes beyond traditional BGP, enhancing load balancing and network optimization capabilities.</strong></mark></p><p class="">
</p><p class="">
</p><p class="">
</p><p class="">
</p><p class="">
</p><p class="">
</p><p class=""><a href="https://www.cloudflare.com/learning/cdn/glossary/anycast-network/">https://www.cloudflare.com/learning/cdn/glossary/anycast-network/</a></p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body>