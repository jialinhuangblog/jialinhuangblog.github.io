<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>AWS VPC — How Network Traffic Travels Through Components</title></head><body><article class="page serif"><header><div class="page-header-icon undefined"><img class="icon" src="https://www.notion.so/icons/document_red.svg"/></div><h1 class="page-title">AWS VPC — How Network Traffic Travels Through Components</h1><p class="page-description"></p><table class="properties"><tbody><tr class="property-row property-row-created_by"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesCreatedBy"><path d="M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM8 10.4229C6.05176 10.4229 4.54785 11.1133 3.83008 11.9131C2.90039 10.9082 2.33301 9.55469 2.33301 8.06445C2.33301 4.91992 4.84863 2.39746 7.99316 2.39746C11.1377 2.39746 13.6738 4.91992 13.6738 8.06445C13.6738 9.55469 13.1064 10.9082 12.1699 11.9131C11.4521 11.1133 9.94824 10.4229 8 10.4229ZM8 9.30176C9.32617 9.30859 10.3516 8.18066 10.3516 6.71094C10.3516 5.33008 9.31934 4.18164 8 4.18164C6.6875 4.18164 5.6416 5.33008 5.64844 6.71094C5.65527 8.18066 6.68066 9.28809 8 9.30176Z"></path></svg></span>Created by</th><td><span class="user"><img src="AWS%20VPC%20%E2%80%94%20How%20Network%20Traffic%20Travels%20Through%20Comp%2010f6cd51990d80b8be74ed616ee8331e/IMG_2295.jpg" class="icon user-icon"/>JiaLin Huang</span></td></tr><tr class="property-row property-row-last_edited_time"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesCreatedAt"><path d="M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM8 13.7383C4.85547 13.7383 2.33301 11.209 2.33301 8.06445C2.33301 4.91992 4.84863 2.39746 7.99316 2.39746C11.1377 2.39746 13.6738 4.91992 13.6738 8.06445C13.6738 11.209 11.1445 13.7383 8 13.7383ZM4.54102 8.91211H7.99316C8.30078 8.91211 8.54004 8.67285 8.54004 8.37207V3.8877C8.54004 3.58691 8.30078 3.34766 7.99316 3.34766C7.69238 3.34766 7.45312 3.58691 7.45312 3.8877V7.83203H4.54102C4.2334 7.83203 4.00098 8.06445 4.00098 8.37207C4.00098 8.67285 4.2334 8.91211 4.54102 8.91211Z"></path></svg></span>Last edited</th><td><time>@2024年9月29日 9:47</time></td></tr><tr class="property-row property-row-multi_select"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesMultipleSelect"><path d="M1.91602 4.83789C2.44238 4.83789 2.87305 4.40723 2.87305 3.87402C2.87305 3.34766 2.44238 2.91699 1.91602 2.91699C1.38281 2.91699 0.952148 3.34766 0.952148 3.87402C0.952148 4.40723 1.38281 4.83789 1.91602 4.83789ZM5.1084 4.52344H14.3984C14.7607 4.52344 15.0479 4.23633 15.0479 3.87402C15.0479 3.51172 14.7607 3.22461 14.3984 3.22461H5.1084C4.74609 3.22461 4.45898 3.51172 4.45898 3.87402C4.45898 4.23633 4.74609 4.52344 5.1084 4.52344ZM1.91602 9.03516C2.44238 9.03516 2.87305 8.60449 2.87305 8.07129C2.87305 7.54492 2.44238 7.11426 1.91602 7.11426C1.38281 7.11426 0.952148 7.54492 0.952148 8.07129C0.952148 8.60449 1.38281 9.03516 1.91602 9.03516ZM5.1084 8.7207H14.3984C14.7607 8.7207 15.0479 8.43359 15.0479 8.07129C15.0479 7.70898 14.7607 7.42188 14.3984 7.42188H5.1084C4.74609 7.42188 4.45898 7.70898 4.45898 8.07129C4.45898 8.43359 4.74609 8.7207 5.1084 8.7207ZM1.91602 13.2324C2.44238 13.2324 2.87305 12.8018 2.87305 12.2686C2.87305 11.7422 2.44238 11.3115 1.91602 11.3115C1.38281 11.3115 0.952148 11.7422 0.952148 12.2686C0.952148 12.8018 1.38281 13.2324 1.91602 13.2324ZM5.1084 12.918H14.3984C14.7607 12.918 15.0479 12.6309 15.0479 12.2686C15.0479 11.9062 14.7607 11.6191 14.3984 11.6191H5.1084C4.74609 11.6191 4.45898 11.9062 4.45898 12.2686C4.45898 12.6309 4.74609 12.918 5.1084 12.918Z"></path></svg></span>Tags</th><td><span class="selected-value select-value-color-purple">Post</span><span class="selected-value select-value-color-red">aws</span></td></tr></tbody></table></header><div class="page-body"><figure class="image" style="text-align:left"><a href="https://icon.icepanel.io/AWS/svg/Networking-Content-Delivery/Virtual-Private-Cloud.svg"><img src="https://icon.icepanel.io/AWS/svg/Networking-Content-Delivery/Virtual-Private-Cloud.svg"/></a></figure><h1 class="">TL;DR</h1><p class="">In a VPC, the Internet Gateway serves as the connection to the internet. Route Tables direct traffic within the VPC and to the IGW. Subnets organize resources and are protected by NACLs at the subnet level and Security Groups at the instance level. A public subnet is defined by its Route Table&#x27;s association with an IGW, allowing internet communication.</p><h1 class="">VPC Main Components</h1><ol type="1" class="numbered-list" start="1"><li>Internet Gateway (IGW)</li></ol><ol type="1" class="numbered-list" start="2"><li>Route Table (RT): Determines where traffic should be directed<p class="">Example entries:</p><ul class="bulleted-list"><li style="list-style-type:disc"><code>0.0.0.0/0 igw-xxxxx</code>: Route all non-local traffic through the Internet Gateway to reach the Internet</li></ul><ul class="bulleted-list"><li style="list-style-type:disc"><code>10.0.0.0/24 local</code>: Direct traffic within the subnet (default and unchangeable)</li></ul></li></ol><ol type="1" class="numbered-list" start="3"><li>Subnets: Associated with route tables and NACLs</li></ol><ol type="1" class="numbered-list" start="4"><li>Network Access Control List (NACL): Controls inbound and outbound traffic at the subnet level</li></ol><ol type="1" class="numbered-list" start="5"><li>Security Group (SG): Acts as a firewall for EC2 instances</li></ol><p class=""><mark class="highlight-blue"><strong>The VPC router often seen in architecture diagrams is actually an abstraction representing route tables</strong></mark></p><h3 class="">Abbreviations</h3><ul class="bulleted-list"><li style="list-style-type:disc">IGW: Internet Gateway</li></ul><ul class="bulleted-list"><li style="list-style-type:disc">RT: Route Table</li></ul><ul class="bulleted-list"><li style="list-style-type:disc">SG: Security Group</li></ul><ul class="bulleted-list"><li style="list-style-type:disc">NACL: Network Access Control List</li></ul><h3 class="">SG vs. NACL</h3><table class="simple-table"><tbody><tr><td class="">aspect</td><td class="">SG</td><td class="">NACL</td></tr><tr><td class="">state</td><td class="">Stateful: means you allow 80 port in, then also for 80 port out.</td><td class="">Stateless: Inbound and outbound rules need to be set separately.</td></tr><tr><td class="">choices</td><td class="">Can specify <mark class="highlight-red"><strong>CIDR, IP, or other security groups</strong></mark> as sources or destinations.</td><td class="">Each subnet can be associated with only one NACL. And only specify <mark class="highlight-red"><strong>CIDR</strong></mark></td></tr><tr><td class="">deal with</td><td class=""><mark class="highlight-red"><strong>allow</strong></mark> x <strong>inbound/outbound</strong></td><td class=""><mark class="highlight-red"><strong>allow/deny</strong></mark> x <strong>inbound/outbound</strong></td></tr><tr><td class="">how it check</td><td class="">Evaluate all the rules</td><td class="">Rules are numbered from 1 to 32766 and evaluated in order, starting with the lowest number.</td></tr></tbody></table><p class=""><strong>SG is Stateful</strong> sounds a bit strange, right? If my inbound port 80 is allowed and the outbound does not have port 80 set, isn’t that contradictory?</p><blockquote class=""> if you had a security group that allowed port 80 inbound but not outbound, the server using that security group would be able to act as a web server for web clients, but you would not be able to access the internet on port 80 from inside it.<br/><br/><a href="https://www.reddit.com/r/AWSCertifications/comments/nmifcn/security_groups_purpose_of_inbound_and_outbound/">https://www.reddit.com/r/AWSCertifications/comments/nmifcn/security_groups_purpose_of_inbound_and_outbound/</a></blockquote><p class="">
</p><h3 class="">Typical VPC Setup Scenario</h3><p class="">When a VPC is created, it comes with default NACL, Route Table, and Internet Gateway. </p><p class="">Subnets can be</p><ol type="1" class="numbered-list" start="1"><li>associated with these default components </li></ol><ol type="1" class="numbered-list" start="2"><li>or with custom RT and NACL. </li></ol><p class="block-color-red"><mark class="highlight-default">Subnets cannot directly associate with an IGW; the association is through the RT. (Subnet → RT → IGW)</mark></p><p class=""><mark class="highlight-default">And Multiple RT can be associated with the same IGW within a VPC.</mark></p><h1 class="">Public Subnet Definition</h1><p class="">A public subnet is defined by its Route Table configuration. <mark class="highlight-red"><strong>It MUST have an entry that routes traffic to an Internet Gateway</strong></mark><strong>.</strong> This is crucial for allowing resources in the subnet to communicate with the internet, regardless of other components.</p><h1 class="">External Traffic Flow to EC2 Instances</h1><ol type="1" class="numbered-list" start="1"><li>Internet Gateway (IGW): Entry point for external requests</li></ol><ol type="1" class="numbered-list" start="2"><li>VPC: IGW routes traffic to appropriate subnets based on VPC network configuration</li></ol><ol type="1" class="numbered-list" start="3"><li>Subnet: Traffic is filtered by the associated NACL</li></ol><ol type="1" class="numbered-list" start="4"><li>If traffic passes NACL, it&#x27;s then checked by the SG of the target resource</li></ol><ol type="1" class="numbered-list" start="5"><li>Traffic finally reaches the target resource (e.g. instance)</li></ol><p class="">
</p><p class=""><mark class="highlight-blue"><strong>Note: External incoming traffic doesn&#x27;t pass through the RT. RTs primarily control traffic originating from within the VPC or moving between subnets.</strong></mark></p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body>