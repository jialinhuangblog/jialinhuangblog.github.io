<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Django: works with uwsgi, or even works with uwsgi &amp; nginx together</title></head><body><article class="page serif"><header><h1 class="page-title">Django: works with uwsgi, or even works with uwsgi &amp; nginx together</h1><p class="page-description"></p><table class="properties"><tbody><tr class="property-row property-row-created_by"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesCreatedBy"><path d="M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM8 10.4229C6.05176 10.4229 4.54785 11.1133 3.83008 11.9131C2.90039 10.9082 2.33301 9.55469 2.33301 8.06445C2.33301 4.91992 4.84863 2.39746 7.99316 2.39746C11.1377 2.39746 13.6738 4.91992 13.6738 8.06445C13.6738 9.55469 13.1064 10.9082 12.1699 11.9131C11.4521 11.1133 9.94824 10.4229 8 10.4229ZM8 9.30176C9.32617 9.30859 10.3516 8.18066 10.3516 6.71094C10.3516 5.33008 9.31934 4.18164 8 4.18164C6.6875 4.18164 5.6416 5.33008 5.64844 6.71094C5.65527 8.18066 6.68066 9.28809 8 9.30176Z"></path></svg></span>Created by</th><td><span class="user"><img src="Django%20works%20with%20uwsgi,%20or%20even%20works%20with%20uwsgi%20%201146cd51990d80f780b7ebcb577e4e66/IMG_2295.jpg" class="icon user-icon"/>JiaLin Huang</span></td></tr><tr class="property-row property-row-last_edited_time"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesCreatedAt"><path d="M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM8 13.7383C4.85547 13.7383 2.33301 11.209 2.33301 8.06445C2.33301 4.91992 4.84863 2.39746 7.99316 2.39746C11.1377 2.39746 13.6738 4.91992 13.6738 8.06445C13.6738 11.209 11.1445 13.7383 8 13.7383ZM4.54102 8.91211H7.99316C8.30078 8.91211 8.54004 8.67285 8.54004 8.37207V3.8877C8.54004 3.58691 8.30078 3.34766 7.99316 3.34766C7.69238 3.34766 7.45312 3.58691 7.45312 3.8877V7.83203H4.54102C4.2334 7.83203 4.00098 8.06445 4.00098 8.37207C4.00098 8.67285 4.2334 8.91211 4.54102 8.91211Z"></path></svg></span>Last edited</th><td><time>@2024年10月3日 19:35</time></td></tr><tr class="property-row property-row-multi_select"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesMultipleSelect"><path d="M1.91602 4.83789C2.44238 4.83789 2.87305 4.40723 2.87305 3.87402C2.87305 3.34766 2.44238 2.91699 1.91602 2.91699C1.38281 2.91699 0.952148 3.34766 0.952148 3.87402C0.952148 4.40723 1.38281 4.83789 1.91602 4.83789ZM5.1084 4.52344H14.3984C14.7607 4.52344 15.0479 4.23633 15.0479 3.87402C15.0479 3.51172 14.7607 3.22461 14.3984 3.22461H5.1084C4.74609 3.22461 4.45898 3.51172 4.45898 3.87402C4.45898 4.23633 4.74609 4.52344 5.1084 4.52344ZM1.91602 9.03516C2.44238 9.03516 2.87305 8.60449 2.87305 8.07129C2.87305 7.54492 2.44238 7.11426 1.91602 7.11426C1.38281 7.11426 0.952148 7.54492 0.952148 8.07129C0.952148 8.60449 1.38281 9.03516 1.91602 9.03516ZM5.1084 8.7207H14.3984C14.7607 8.7207 15.0479 8.43359 15.0479 8.07129C15.0479 7.70898 14.7607 7.42188 14.3984 7.42188H5.1084C4.74609 7.42188 4.45898 7.70898 4.45898 8.07129C4.45898 8.43359 4.74609 8.7207 5.1084 8.7207ZM1.91602 13.2324C2.44238 13.2324 2.87305 12.8018 2.87305 12.2686C2.87305 11.7422 2.44238 11.3115 1.91602 11.3115C1.38281 11.3115 0.952148 11.7422 0.952148 12.2686C0.952148 12.8018 1.38281 13.2324 1.91602 13.2324ZM5.1084 12.918H14.3984C14.7607 12.918 15.0479 12.6309 15.0479 12.2686C15.0479 11.9062 14.7607 11.6191 14.3984 11.6191H5.1084C4.74609 11.6191 4.45898 11.9062 4.45898 12.2686C4.45898 12.6309 4.74609 12.918 5.1084 12.918Z"></path></svg></span>Tags</th><td><span class="selected-value select-value-color-purple">Post</span><span class="selected-value select-value-color-blue">django</span><span class="selected-value select-value-color-orange">nginx</span><span class="selected-value select-value-color-gray">python</span><span class="selected-value select-value-color-yellow">socket</span><span class="selected-value select-value-color-brown">uwsgi</span></td></tr></tbody></table></header><div class="page-body"><p class="">
</p><h1 class=""><strong>Foundations</strong></h1><ul class="bulleted-list"><li style="list-style-type:disc">Django: Python web framework</li></ul><ul class="bulleted-list"><li style="list-style-type:disc">uWSGI: Application server, handles Python code execution</li></ul><ul class="bulleted-list"><li style="list-style-type:disc">Nginx: Web server, handles static files and reverse proxy</li></ul><p class="">The final architecture of this page will be:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">Browser -&gt; Nginx -&gt; uWSGI -&gt; Django</code></pre><p class="">
</p><p class="">
</p><p class="">
</p><p class="">
</p><h1 class="">Basic Environment</h1><p class="">I&#x27;m using venv + poetry here:</p><ol type="1" class="numbered-list" start="1"><li>venv for virtual environment management</li></ol><ol type="1" class="numbered-list" start="2"><li>poetry to enhance venv: venv doesn&#x27;t manage dependency packages<ol type="a" class="numbered-list" start="1"><li>I used to frequently use requirements.txt with pip, but I’m tired of it.</li></ol></li></ol><p class="">
</p><h3 class="">Setting up the Environment</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash"># Create virtual environment
python -m venv myenv

# Activate virtual environment
source myenv/bin/activate

# Use Poetry for dependency management
python -m pip install poetry</code></pre><h3 class="">Package Management</h3><p class="">It&#x27;s kind of like when you do <code><strong>npm init</strong></code></p><p class="">I&#x27;ve written <strong>golang</strong> before and you can use <code><strong>go tidy</strong></code> to automatically register needed packages and delete unnecessary ones. Too bad poetry doesn&#x27;t have this feature, you can only add slowly.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash"># manually add
poetry init  # create pyproject.toml
poetry add django
poetry add uwsgi</code></pre><p class="">poetry install will refer to existing file</p><ul class="bulleted-list"><li style="list-style-type:disc"><code>poetry.lock</code></li></ul><ul class="bulleted-list"><li style="list-style-type:disc"><code>pyproject.toml</code> (if no <code>poetry.lock</code>)</li></ul><ul class="bulleted-list"><li style="list-style-type:disc">If not, you manually poetry add ...</li></ul><p class="">But when pulling a project from remote, you usually have .lock or .toml files, you can directly <code>poetry install</code></p><p class="">
</p><p class="">
</p><h1 class="">Django Basic Setup</h1><p class="">The most basic Django installation, start a project, make a ping in that project</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">django-admin startproject mywebsite
cd jialinwebsite</code></pre><ul class="toggle"><li><details open=""><summary>File structure</summary><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">jango/
├── manage.py
├── mywebsite/
│   ├── __init__.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py</code></pre></details></li></ul><p class="">
</p><p class="">
</p><p class="">Of course, you&#x27;ll want to add other routes:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">django-admin startapp ping</code></pre><ul class="toggle"><li><details open=""><summary>File structure</summary><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">mywebsite/
├── manage.py
├── mywebsite/
│   ├── __init__.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
└── ping/
    ├── __init__.py
    ├── views.py
    ├── urls.py
    └── apps.py</code></pre></details></li></ul><p class="">
</p><p class="">In <code>ping/views.py</code></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Python">from django.http import HttpResponse

def ping_response(request):
    return HttpResponse(&quot;pong&quot;)</code></pre><p class="">In <code>ping/urls.py</code></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Python">from django.urls import path
from . import views

urlpatterns = [
    path(&#x27;ping/&#x27;, views.ping_response, name=&#x27;ping_view&#x27;),
]</code></pre><p class="">In the main <code>mywebsite/urls.py</code></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Python">from django.contrib import admin
from django.urls import include, path
urlpatterns = [
    path(&#x27;admin/&#x27;, admin.site.urls),
    path(&#x27;&#x27;, include(&#x27;ping.urls&#x27;)) # add this
]</code></pre><p class="">
</p><h3 class="">A Quick Note</h3><p class="">In Django, naming URL patterns (like <code>name=&#x27;ping_view&#x27;</code> from <code>urls.py</code>) has several benefits:</p><ol type="1" class="numbered-list" start="1"><li>Use in templates<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">&lt;a href=&quot;{% url &#x27;ping_view&#x27; %}&quot;&gt;Ping Page&lt;/a&gt;</code></pre></li></ol><ol type="1" class="numbered-list" start="2"><li>Or use in views<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Python">from django.urls import reverse
from django.http import HttpResponseRedirect

def some_view(request):
    return HttpResponseRedirect(reverse(&#x27;ping_view&#x27;))</code></pre></li></ol><p class="">If you need to change the URL structure in the future (e.g., from <code>ping/</code> to <code>greetings/</code>), you only need to modify <code>urls.py</code>, without updating all references in templates and views.</p><h3 class="">Run!</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">python manage.py runserver</code></pre><p class="">
</p><p class=""><mark class="highlight-blue">👏 </mark><mark class="highlight-blue"><strong>Now you can start a simple django!</strong></mark></p><p class="">
</p><p class="">
</p><p class="">
</p><h1 class="">Adding uWSGI</h1><h3 class="">Why do we need uWSGI?</h3><p class="">uWSGI as an application server can handle Python code execution more effectively and work well with web servers like Nginx. </p><p class="">The original thin django is convenient for development, but when it comes to actually becoming a publish, it will have problems handling high traffic, and although it&#x27;s a multi-thread framework, it needs to rely on external tools to achieve this.</p><p class="">Although it can handle application-level errors like 404, 500, it can&#x27;t handle server-level errors, and doesn&#x27;t have built-in SSL settings, only relying on external integration.</p><p class="">uWSGI as an application server can handle Python code execution more effectively and can work well with web servers like Nginx later.</p><p class="">
</p><h3 class="">Basic Configuration</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">pip install uwsgi</code></pre><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash"># uwsgi.ini
[uwsgi] # must have this section
http = :9555
module = mywebsite.wsgi:application
vacuum = True # do clean up after shut down
pidfile = /tmp/wsgi.pid # if you want tracking this process.</code></pre><p class="">Start django with uwsgi, and you can see the django server at <code>localhost:9555</code>.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">uwsgi --ini uwsgi.ini</code></pre><p class="">
</p><p class=""><mark class="highlight-blue"><strong>👏 Now at this point, you&#x27;ve integrated uwsgi + django, next we&#x27;ll integrate uwsgi+nginx.</strong></mark></p><p class="">
</p><p class="">
</p><p class="">
</p><h1 class="">Here comes nginx</h1><h3 class="">Before</h3><p class="">uWSGI directly serves as an HTTP server, handling HTTP requests from clients</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">Browser -&gt; uWSGI -&gt; django</code></pre><p class="">django+uwsgi only</p><h3 class="">Now</h3><p class="">But now you might consider: <strong>nginx is better at handling security like SSL, and better performance on static files, and if you have multiple uWSGIs, you can also let nginx proxy multiple uWSGIs to achieve load balancing.</strong><br/>Now I want to change uWSGI&#x27;s responsibilities, uWSGI no longer directly handles HTTP requests, but communicates with Nginx through a socket.<br/></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">Browser -&gt; nginx -&gt; Unix.socket -&gt; uWSGI -&gt; django</code></pre><p class="">
</p><h3 class=""><code>uwsgi.ini</code> now uses socket communication instead of http</h3><p class="">Now we&#x27;re integrating nginx, so of course, the communication method needs to change. The socket field below is when <code>uwsgi --ini uwsgi.ini</code> starts running, it will create a socket to communicate with nginx.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">[uwsgi]
module = jialinwebsite.wsgi:application
# %(base_dir)s/mywebsite.sock
socket = /Users/jialinhuang/Desktop/jango/jialinwebsite/www.sock
vacuum = True
pidfile = /tmp/wsgi.pid
debug = True</code></pre><p class="">
</p><p class="">
</p><h3 class="">Install nginx</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">brew install nginx</code></pre><p class="">
</p><h3 class="">Configure nginx related files</h3><ol type="1" class="numbered-list" start="1"><li>Create custom configuration folder, and add files for the next step. <p class="">Also nginx files on macOS are in <code>/opt/homebrew/etc/nginx/</code></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">mkdir -p /opt/homebrew/etc/nginx/sites-available
touch /opt/homebrew/etc/nginx/sites-available/mywebsite
vim /opt/homebrew/etc/nginx/sites-available/mywebsite</code></pre></li></ol><ol type="1" class="numbered-list" start="2"><li>Create site configuration file, this is the nginx conf file we&#x27;ll use later<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash"># /opt/homebrew/etc/nginx/sites-available/mywebsite
server {
    listen 80;
    server_name localhost;

    location = /favicon.ico { access_log off; log_not_found off; }
    location /static/ {
        root /path/to/your/static/files;
    }

    location / {
        include uwsgi_params;
        uwsgi_pass unix:/Users/jialinhuang/Desktop/jango/jialinwebsite/www.sock;
    }
}</code></pre></li></ol><ol type="1" class="numbered-list" start="3"><li>Create soft link to sites-enabled<p class="">The second step is you as a candidate, this step is you as an elected one</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">sudo ln -s /opt/homebrew/etc/nginx/sites-available/mywebsite /opt/homebrew/etc/nginx/sites-enabled/</code></pre><p class=""><strong>/nginx/sites-available vs. /nginx/sites-enabled</strong></p><blockquote class="">Both store config files, but sites-available can be considered candidates, and<mark class="highlight-red"><strong> sites-enabled are actively enabled.</strong></mark></blockquote></li></ol><p class="">
</p><ol type="1" class="numbered-list" start="1"><li>Include custom configuration in the main Nginx configuration file<p class="">Add this line <code><strong>include /opt/homebrew/etc/nginx/sites-enabled/*;</strong></code><strong><br/>to <br/></strong><code><strong>/opt/homebrew/etc/nginx/nginx.conf</strong></code> <strong>in the http block</strong></p><p class="">Why? Because every time nginx restarts, it will include that it needs to include the configuration files in site-enabled.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash"># /opt/homebrew/etc/nginx/nginx.conf
http {
    include       mime.types;
    default_type  application/octet-stream;
    include /opt/homebrew/etc/nginx/sites-enabled/*;
}</code></pre></li></ol><p class="">
</p><p class="">
</p><h3 class="">nginx user configuration</h3><p class="">The reason will be explained below</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">user &lt;username&gt; staff;
# or
user root staff;</code></pre><h3 class="">nginx restart</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">sudo nginx -t  # Test configuration
sudo nginx -s reload  # Reload configuration</code></pre><p class="">
</p><p class="">Finally, remember to start uwsgi.... Because nginx is just doing reverse proxy, remember to start your uwsgi service behind it</p><p class="">
</p><p class="">
</p><h3 class="">Note</h3><ol type="1" class="numbered-list" start="1"><li>Make sure the uwsgi_pass path in your custom <code>/opt/homebrew/etc/nginx/sites-available/jialinwebsite</code> file matches the socket path in <code>uwsgi.ini</code></li></ol><ol type="1" class="numbered-list" start="2"><li>Confirm the static file path is correct.</li></ol><ol type="1" class="numbered-list" start="3"><li>Make sure the Nginx main configuration file can load configurations in sites-enabled, and your own configuration should be in site-enabled/.</li></ol><ol type="1" class="numbered-list" start="4"><li>And whenever there&#x27;s any change in nginx configuration, remember <code>sudo nginx -s reload</code>, always.</li></ol><p class="">
</p><p class="">
</p><p class="">
</p><h1 class="">DEBUG Nginx unable to connect to uWSGI socket</h1><p class=""><strong>This is very important and related to the user field at the very beginning of</strong> <code><strong>/opt/homebrew/etc/nginx/nginx.conf</strong></code></p><p class="">
</p><p class="">After I set it up, I found that nginx couldn&#x27;t connect no matter what, and there was no message on the uwsgi backend, so I checked</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">tail -f /opt/homebrew/var/log/nginx/error.log</code></pre><ul class="toggle"><li><details open=""><summary>fail log</summary><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">2024/10/02 23:55:20 [crit] 22768#0: *1 connect() to 
unix:/Users/jialinhuang/Desktop/jango/jialinwebsite/www.sock 
failed (13: Permission denied) while connecting to upstream, 
client: 127.0.0.1, server: localhost, 
request: &quot;GET /ping HTTP/1.1&quot;, 
upstream: &quot;uwsgi://unix:/Users/jialinhuang/Desktop/jango/jialinwebsite/www.sock:&quot;, 
host: &quot;localhost”</code></pre></details></li></ul><p class="">It should be insufficient permissions to operate www.sock, so I checked the permissions of this file</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash"> $  ls -l jialinwebsite                                   on  main!
-rw-r--r--   1 jialinhuang  staff  583  3 Oct 10:53 uwsgi.ini
srwxr-xr-x   1 jialinhuang  staff    0  3 Oct 10:53 www.sock</code></pre><p class="">
</p><p class=""><strong>TRY 1: Set</strong> <code><strong>chmod-socket = 777</strong></code> <strong>to deliberately make the socket in the most freely accessible state?</strong></p><p class="">Set <code>chmod-socket = 777</code> in uwsgi.ini, and <code>/opt/homebrew/etc/nginx/nginx.conf</code> is unchanged by default, which means it doesn&#x27;t have a user field</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">socket = /Users/jialinhuang/Desktop/jango/jialinwebsite/www.sock
chmod-socket = 777</code></pre><p class=""><code>/opt/homebrew/etc/nginx/nginx.conf</code></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">#user  nobody;</code></pre><p class="">
</p><p class="">It doesn&#x27;t work. When Nginx doesn&#x27;t specify a user to run as, it might run as the system&#x27;s default low-privilege user (like nobody or www-data). These low-privilege users might not be able to enter the directory where the .sock file is located, even if the file itself has 777 permissions, the directory&#x27;s permissions also need to allow access.</p><p class="">
</p><p class="">
</p><p class=""><strong>TRY 2: Specify the user field, and don&#x27;t give</strong> <code><strong>chmod-socket = 777</strong></code> <strong>in uwsgi.ini</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">socket = /Users/jialinhuang/Desktop/jango/jialinwebsite/www.sock
# chmod-socket = 777</code></pre><p class="">No need to manage chmod, but just write this in <code>/opt/homebrew/etc/nginx/nginx.conf</code></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash"># user  nobody;

user jialinhuang staff; # yes, it works
user root staff;        # yes, it works
user jialinhuang;       # no, do not use
user root               # no, do not use</code></pre><p class="">
</p><p class="">So from the above configuration, we can know that it&#x27;s not related to chmod, <mark class="highlight-red"><strong>but more related to what identity nginx runs as.</strong></mark></p><p class="">
</p><p class="">
</p><p class="">
</p><p class="">
</p><p class="">
</p><p class="">
</p><p class="">
</p><h1 class="">Socket Type Comparison</h1><h3 class="">TCP socket vs. Unix socket</h3><p class="">We mentioned earlier that the <strong>uwsgi_pass in </strong><code><strong>/opt/homebrew/etc/nginx/sites-available/jialinwebsite</strong></code> and the <strong>socket field in </strong><code><strong>uwsgi.ini</strong></code> must be the same.</p><p class="">You can choose to use Unix Socket, which is for local use and can avoid network overhead, so it&#x27;s limited to <strong>inter-process communication(IPC)</strong> on the same machine. At the beginning above, we used the Unix method, directly writing the file path.</p><p class=""><strong>Unix socket</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash"># /opt/homebrew/etc/nginx/sites-available/jialinwebsite
uwsgi_pass unix:/path/to/your/mywebsite.sock;</code></pre><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash"># uwsgi.ini
socket = /path/to/your/mywebsite.sock</code></pre><p class="">
</p><p class="">If you want to change to TCP socket, you can, after all, in addition to many network testing tools, it can also make cross-machine possible. The following is simply changing the original unix to TCP</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash"># /opt/homebrew/etc/nginx/sites-available/jialinwebsite
server {
    # ...
    location / {
        include uwsgi_params;
        uwsgi_pass 127.0.0.1:8000;
    }
}</code></pre><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">[uwsgi]
socket = 127.0.0.1:8000</code></pre><p class="">
</p><p class="">
</p><h3 class="">Why is TCP Socket better when thinking about load balancing?</h3><p class="">Look, below is the cross-machine writing method.</p><p class="">When I get to the root <code>/</code> nginx will know to give it to <code>backend</code>, <code>backend</code> has two machines that can be sent to, you can also set weight to achieve traffic ratio adjustment</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash"># if is 
# Unix socket (same host)
upstream backend {
    server unix:/path/to/socket1.sock;
    server unix:/path/to/socket2.sock;
}

# else 
# TCP socket (different hosts)
upstream backend {
    server 192.168.1.10:8000;
    server 192.168.1.11:8000;
}

# load balancing with TCP socket
upstream backend {
    server 192.168.1.10:8000 weight=3;
    server 192.168.1.11:8000;
}</code></pre><p class="">
</p><p class="">
</p><p class="">
</p><p class="">
</p><h1 class="">Is pipx design against its original intention? (You can skip this part)</h1><p class="">I defaulted to the idea of node&#x27;s npx, thinking I&#x27;d use pipx to run python first, but found many inconveniences, not as intuitive to use. For example:</p><p class="">I thought I could directly use python when I entered, but apparently python and pipx environments are different. Essentially, pipx is a global virtual environment, not globally available. Even if you&#x27;re not in a virtual environment yourself, pipx is its own set of virtual environments?</p><p class="">The following is my imitation of the initial setup, globally installing django CLI with pipx for convenience later. <strong>Using django alone is no problem, just slightly different from the commands set at the beginning of this article, and it runs</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash"># go to directory
cd pipx-django
pipx install django

# create project
django-admin startproject mywebsite
cd mywebsite
django-admin startapp ping

# do some view.py, urls.py .. setup


# RUN
django-admin runserver</code></pre><p class="">
</p><p class="">But when I wanted to run through <code>uwsgi.ini</code></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">uwsgi --ini uwsgi.ini</code></pre><ul class="toggle"><li><details open=""><summary>error log</summary><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">[uWSGI] getting INI configuration from uwsgi.ini
*** Starting uWSGI 2.0.27 (64bit) on [Thu Oct  3 18:18:52 2024] ***
compiled with version: Apple LLVM 15.0.0 (clang-1500.3.9.4) on 02 October 2024 14:21:09
os: Darwin-23.4.0 Darwin Kernel Version 23.4.0: Wed Feb 21 21:44:43 PST 2024; root:xnu-10063.101.15~2/RELEASE_ARM64_T6000
nodename: JiaLins-MacBook-Pro.local
machine: arm64
clock source: unix
pcre jit disabled
detected number of CPU cores: 10
current working directory: /Users/jialinhuang/Desktop/pipx-django/mywebsite
writing pidfile to /tmp/wsgi.pid # if you want tracking this process.
detected binary path: /Users/jialinhuang/.local/pipx/venvs/uwsgi/bin/uwsgi
*** WARNING: you are running uWSGI without its master process manager ***
your processes number limit is 2666
your memory page size is 16384 bytes
detected max file descriptor number: 256
lock engine: OSX spinlocks
thunder lock: disabled (you can enable it with --thunder-lock)
uWSGI http bound on :9555 fd 4
spawned uWSGI http 1 (pid: 86592)
uwsgi socket 0 bound to TCP address 127.0.0.1:63803 (port auto-assigned) fd 3
Python version: 3.12.6 (main, Sep  6 2024, 19:03:47) [Clang 15.0.0 (clang-1500.3.9.4)]
Python main interpreter initialized at 0x101880e00
python threads support enabled
your server socket listen backlog is limited to 100 connections
your mercy for graceful operations on workers is 60 seconds
mapped 72896 bytes (71 KB) for 1 cores
*** Operational MODE: single process ***
Traceback (most recent call last):
  File &quot;/Users/jialinhuang/Desktop/pipx-django/mywebsite/mywebsite/wsgi.py&quot;, line 12, in &lt;module&gt;
    from django.core.wsgi import get_wsgi_application
ModuleNotFoundError: No module named &#x27;django&#x27;
unable to load app 0 (mountpoint=&#x27;&#x27;) (callable not found or import error)
*** no app loaded. going in full dynamic mode ***
*** uWSGI is running in multiple interpreter mode ***
spawned uWSGI worker 1 (and the only) (pid: 86591, cores: 1)</code></pre></details></li></ul><p class="">
</p><p class=""><strong>Simply put, it can&#x27;t find Django.</strong> This is because when uWSGI starts up, it uses the system Python path to look for installed packages. Django is managed by pipx and located in a <strong>global virtual environment</strong>, so uWSGI can&#x27;t automatically find Django. </p><p class="">That&#x27;s why uwsgi needs this extra configuration line to <strong>explicitly specify where my virtual environment</strong> is: <code>virtualenv = /Users/jialinhuang/.local/pipx/venvs/django</code></p><p class="">
</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash"># uwsgi.ini
[uwsgi]
http = :9555
module = mywebsite.wsgi:application
vacuum = True
pidfile = /tmp/wsgi.pid
virtualenv = /Users/jialinhuang/.local/pipx/venvs/django</code></pre><p class="">
</p><p class="">This really goes against pipx&#x27;s original intention, doesn&#x27;t it? </p><p class=""><strong>Sure, pipx simplifies a lot of global settings, but it adds some complexity in actual development. </strong></p><p class="">At first, I naively thought it would be intuitive like my nodejs npx concept and just used it, but I found pipx isn&#x27;t that intuitive. And the issues it&#x27;s trying to solve still end up happening anyway.</p><p class="">
</p><p class="">Uh. Bye</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">brew uninstall pipx
rm -rf ~/.local/pipx</code></pre><p class="">
</p><p class="">
</p><h1 class="">References</h1><p class=""><a href="https://unix.stackexchange.com/questions/111346/what-is-the-difference-between-gid-and-groups">https://unix.stackexchange.com/questions/111346/what-is-the-difference-between-gid-and-groups</a></p><p class=""><a href="http://nginx.org/en/docs/beginners_guide.html">http://nginx.org/en/docs/beginners_guide.html</a></p><p class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body>