<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>How SameSite, Same-Origin, and CORS Partially Block XSS and CSRF Attacks</title></head><body><article class="page serif"><header><h1 class="page-title"><strong>How SameSite, Same-Origin, and CORS </strong><code><strong>Partially</strong></code><strong> Block XSS and CSRF Attacks</strong></h1><p class="page-description"></p><table class="properties"><tbody><tr class="property-row property-row-created_by"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesCreatedBy"><path d="M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM8 10.4229C6.05176 10.4229 4.54785 11.1133 3.83008 11.9131C2.90039 10.9082 2.33301 9.55469 2.33301 8.06445C2.33301 4.91992 4.84863 2.39746 7.99316 2.39746C11.1377 2.39746 13.6738 4.91992 13.6738 8.06445C13.6738 9.55469 13.1064 10.9082 12.1699 11.9131C11.4521 11.1133 9.94824 10.4229 8 10.4229ZM8 9.30176C9.32617 9.30859 10.3516 8.18066 10.3516 6.71094C10.3516 5.33008 9.31934 4.18164 8 4.18164C6.6875 4.18164 5.6416 5.33008 5.64844 6.71094C5.65527 8.18066 6.68066 9.28809 8 9.30176Z"></path></svg></span>Created by</th><td><span class="user"><img src="How%20SameSite,%20Same-Origin,%20and%20CORS%20Partially%20Bloc%201206cd51990d807cad41dc435227707f/IMG_2295.jpg" class="icon user-icon"/>JiaLin Huang</span></td></tr><tr class="property-row property-row-last_edited_time"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesCreatedAt"><path d="M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM8 13.7383C4.85547 13.7383 2.33301 11.209 2.33301 8.06445C2.33301 4.91992 4.84863 2.39746 7.99316 2.39746C11.1377 2.39746 13.6738 4.91992 13.6738 8.06445C13.6738 11.209 11.1445 13.7383 8 13.7383ZM4.54102 8.91211H7.99316C8.30078 8.91211 8.54004 8.67285 8.54004 8.37207V3.8877C8.54004 3.58691 8.30078 3.34766 7.99316 3.34766C7.69238 3.34766 7.45312 3.58691 7.45312 3.8877V7.83203H4.54102C4.2334 7.83203 4.00098 8.06445 4.00098 8.37207C4.00098 8.67285 4.2334 8.91211 4.54102 8.91211Z"></path></svg></span>Last edited</th><td><time>@2024年10月16日 13:47</time></td></tr><tr class="property-row property-row-multi_select"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesMultipleSelect"><path d="M1.91602 4.83789C2.44238 4.83789 2.87305 4.40723 2.87305 3.87402C2.87305 3.34766 2.44238 2.91699 1.91602 2.91699C1.38281 2.91699 0.952148 3.34766 0.952148 3.87402C0.952148 4.40723 1.38281 4.83789 1.91602 4.83789ZM5.1084 4.52344H14.3984C14.7607 4.52344 15.0479 4.23633 15.0479 3.87402C15.0479 3.51172 14.7607 3.22461 14.3984 3.22461H5.1084C4.74609 3.22461 4.45898 3.51172 4.45898 3.87402C4.45898 4.23633 4.74609 4.52344 5.1084 4.52344ZM1.91602 9.03516C2.44238 9.03516 2.87305 8.60449 2.87305 8.07129C2.87305 7.54492 2.44238 7.11426 1.91602 7.11426C1.38281 7.11426 0.952148 7.54492 0.952148 8.07129C0.952148 8.60449 1.38281 9.03516 1.91602 9.03516ZM5.1084 8.7207H14.3984C14.7607 8.7207 15.0479 8.43359 15.0479 8.07129C15.0479 7.70898 14.7607 7.42188 14.3984 7.42188H5.1084C4.74609 7.42188 4.45898 7.70898 4.45898 8.07129C4.45898 8.43359 4.74609 8.7207 5.1084 8.7207ZM1.91602 13.2324C2.44238 13.2324 2.87305 12.8018 2.87305 12.2686C2.87305 11.7422 2.44238 11.3115 1.91602 11.3115C1.38281 11.3115 0.952148 11.7422 0.952148 12.2686C0.952148 12.8018 1.38281 13.2324 1.91602 13.2324ZM5.1084 12.918H14.3984C14.7607 12.918 15.0479 12.6309 15.0479 12.2686C15.0479 11.9062 14.7607 11.6191 14.3984 11.6191H5.1084C4.74609 11.6191 4.45898 11.9062 4.45898 12.2686C4.45898 12.6309 4.74609 12.918 5.1084 12.918Z"></path></svg></span>Tags</th><td><span class="selected-value select-value-color-default">HTTP</span></td></tr></tbody></table></header><div class="page-body"><p class="">
</p><p class="">
</p><p class="">I’ve read many articles on XSS, CSRF, CORS, and SameSite cookies before, but they were often presented separately, which sometimes left me feeling all mixed up. Therefore, I’ve compiled this overview. </p><p class="">If you don’t have prior knowledge of these topics, you might find this article super confusing LOL, so it’s best to refer to the relevant standalone articles for a clearer understanding.</p><h1 class="">Samesite</h1><ul class="bulleted-list"><li style="list-style-type:disc"><code><strong>Strict</strong></code>: You ain&#x27;t getting my cookies with CSRF</li></ul><ul class="bulleted-list"><li style="list-style-type:disc"><code><strong>Lax</strong></code>: You can get cookies under certain conditions<ul class="bulleted-list"><li style="list-style-type:circle">top-level navigation</li></ul><ul class="bulleted-list"><li style="list-style-type:circle">HTTP GET method. Flip side, <mark class="highlight-red">to avoid CSRF risks with lax, just try to avoid using GET</mark></li></ul></li></ul><ul class="bulleted-list"><li style="list-style-type:disc">Limited in preventing XSS, but you can mitigate one XSS method by setting <code><strong>Secure; HttpOnly</strong></code>, as it&#x27;ll stop the browser from reading document.cookies. But this is just for cookies. If they use malicious scripts, you&#x27;ve got way more to worry about.<br/>Keep it simple: can prevent XSS from stealing cookies, but can&#x27;t stop other XSS plays.<br/></li></ul><p class="">
</p><p class=""><mark class="highlight-blue"><strong>Can greatly prevent CSRF, but only moderately mitigates XSS.</strong></mark></p><h1 class="">Same Origin</h1><p class="">Mitigates XSS, malicious scripts from different origins can&#x27;t run</p><p class="">Same origin itself restricts interactions from different origins, but CSRF pretends to be from the same origin when sending, bypassing Same Origin restrictions. Plus, CSRF&#x27;s malicious behavior is in the &quot;sending&quot;, not the reading.</p><p class="">
</p><p class=""><mark class="highlight-blue"><strong>Significantly prevents XSS, but has little constraint on CSRF since CSRF is about faking identity when sending requests, which Same Origin doesn&#x27;t really restrict.</strong></mark></p><h1 class="">Cross Origin</h1><p class="">So, does enabling CORS mitigate XSS or CSRF?</p><h3 class="">CSRF</h3><p class="">When Cross origin is enabled, it usually comes with headers for checking. CSRF might not get past this checkpoint.</p><p class="">Even if the request does go through, the CORS mechanism can still prevent you from reading the response.</p><h3 class="">XSS</h3><p class="">As for XSS, unless it makes a cross-origin request and gets caught by header checks, XSS itself can&#x27;t be eliminated just because CORS mechanisms exist.</p><p class="">Still, CORS can&#x27;t stop other XSS plays</p><p class="">
</p><p class="">
</p><p class="">
</p><h1 class="">CSRF</h1><p class="">Why CSRF can bypass Same Origin: Same Origin&#x27;s focus is on &quot;reading&quot; conditions within the same origin, not &quot;sending&quot;. </p><p class="">My CSRF is pretending to be same origin when &quot;sending&quot;, so the two aren&#x27;t really related.</p><p class="">Dealing with CSRF isn&#x27;t a single-choice thing, it&#x27;s multiple choices as barriers.</p><h3 class="">front</h3><ul class="bulleted-list"><li style="list-style-type:disc">set csrf token sent by backend</li></ul><ul class="bulleted-list"><li style="list-style-type:disc">samesite policy constraints given by the backend</li></ul><h3 class="">backend</h3><ul class="bulleted-list"><li style="list-style-type:disc">samesite header </li></ul><ul class="bulleted-list"><li style="list-style-type:disc">check CSRF token</li></ul><ul class="bulleted-list"><li style="list-style-type:disc">define http headers, then check when request comes.<p class="">Do some special headers, CSRF pretends to be a normal person transmitting but there are some headers it can&#x27;t know about, backend checks will catch that it&#x27;s a fake request.</p></li></ul><ul class="bulleted-list"><li style="list-style-type:disc">check origin?</li></ul><ul class="bulleted-list"><li style="list-style-type:disc">check referer?<ul class="bulleted-list"><li style="list-style-type:circle"><strong>referer has more than origin</strong>, it&#x27;s got the path. More detailed url.</li></ul></li></ul><p class="">
</p><p class="">
</p><p class="">
</p><h1 class="">XSS</h1><p class="">Well, if you don&#x27;t have XSS defense mechanisms and an XSS script succeeds, it can execute CSRF, and even sniff out CSRF-related checks like origin, referer, and even csrf token. Then you&#x27;re screwed.</p><p class="">
</p><p class="">
</p><h1 class="">Short thought</h1><p class="">Prioritize solving XSS, otherwise even amount of CSRF checking methods will do no good.</p><p class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body>