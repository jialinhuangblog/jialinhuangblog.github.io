<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Differences: Dockerfile CMD vs. ENTRYPOINT</title></head><body><article class="page serif"><header><div class="page-header-icon undefined"><img class="icon" src="https://www.notion.so/icons/help-alternate_red.svg"/></div><h1 class="page-title">Differences: Dockerfile CMD vs. ENTRYPOINT</h1><p class="page-description"></p><table class="properties"><tbody><tr class="property-row property-row-created_by"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesCreatedBy"><path d="M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM8 10.4229C6.05176 10.4229 4.54785 11.1133 3.83008 11.9131C2.90039 10.9082 2.33301 9.55469 2.33301 8.06445C2.33301 4.91992 4.84863 2.39746 7.99316 2.39746C11.1377 2.39746 13.6738 4.91992 13.6738 8.06445C13.6738 9.55469 13.1064 10.9082 12.1699 11.9131C11.4521 11.1133 9.94824 10.4229 8 10.4229ZM8 9.30176C9.32617 9.30859 10.3516 8.18066 10.3516 6.71094C10.3516 5.33008 9.31934 4.18164 8 4.18164C6.6875 4.18164 5.6416 5.33008 5.64844 6.71094C5.65527 8.18066 6.68066 9.28809 8 9.30176Z"></path></svg></span>Created by</th><td><span class="user"><img src="Differences%20Dockerfile%20CMD%20vs%20ENTRYPOINT%201dcb1f59a8494a5287b5737e1fb37554/IMG_2295.jpg" class="icon user-icon"/>JiaLin Huang</span></td></tr><tr class="property-row property-row-last_edited_time"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesCreatedAt"><path d="M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM8 13.7383C4.85547 13.7383 2.33301 11.209 2.33301 8.06445C2.33301 4.91992 4.84863 2.39746 7.99316 2.39746C11.1377 2.39746 13.6738 4.91992 13.6738 8.06445C13.6738 11.209 11.1445 13.7383 8 13.7383ZM4.54102 8.91211H7.99316C8.30078 8.91211 8.54004 8.67285 8.54004 8.37207V3.8877C8.54004 3.58691 8.30078 3.34766 7.99316 3.34766C7.69238 3.34766 7.45312 3.58691 7.45312 3.8877V7.83203H4.54102C4.2334 7.83203 4.00098 8.06445 4.00098 8.37207C4.00098 8.67285 4.2334 8.91211 4.54102 8.91211Z"></path></svg></span>Last edited</th><td><time>@2024年9月24日 9:13</time></td></tr><tr class="property-row property-row-multi_select"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesMultipleSelect"><path d="M1.91602 4.83789C2.44238 4.83789 2.87305 4.40723 2.87305 3.87402C2.87305 3.34766 2.44238 2.91699 1.91602 2.91699C1.38281 2.91699 0.952148 3.34766 0.952148 3.87402C0.952148 4.40723 1.38281 4.83789 1.91602 4.83789ZM5.1084 4.52344H14.3984C14.7607 4.52344 15.0479 4.23633 15.0479 3.87402C15.0479 3.51172 14.7607 3.22461 14.3984 3.22461H5.1084C4.74609 3.22461 4.45898 3.51172 4.45898 3.87402C4.45898 4.23633 4.74609 4.52344 5.1084 4.52344ZM1.91602 9.03516C2.44238 9.03516 2.87305 8.60449 2.87305 8.07129C2.87305 7.54492 2.44238 7.11426 1.91602 7.11426C1.38281 7.11426 0.952148 7.54492 0.952148 8.07129C0.952148 8.60449 1.38281 9.03516 1.91602 9.03516ZM5.1084 8.7207H14.3984C14.7607 8.7207 15.0479 8.43359 15.0479 8.07129C15.0479 7.70898 14.7607 7.42188 14.3984 7.42188H5.1084C4.74609 7.42188 4.45898 7.70898 4.45898 8.07129C4.45898 8.43359 4.74609 8.7207 5.1084 8.7207ZM1.91602 13.2324C2.44238 13.2324 2.87305 12.8018 2.87305 12.2686C2.87305 11.7422 2.44238 11.3115 1.91602 11.3115C1.38281 11.3115 0.952148 11.7422 0.952148 12.2686C0.952148 12.8018 1.38281 13.2324 1.91602 13.2324ZM5.1084 12.918H14.3984C14.7607 12.918 15.0479 12.6309 15.0479 12.2686C15.0479 11.9062 14.7607 11.6191 14.3984 11.6191H5.1084C4.74609 11.6191 4.45898 11.9062 4.45898 12.2686C4.45898 12.6309 4.74609 12.918 5.1084 12.918Z"></path></svg></span>Tags</th><td><span class="selected-value select-value-color-green">Archives</span></td></tr></tbody></table></header><div class="page-body"><h1 class="">Common</h1><p class="">We&#x27;re discussing these forms first because they&#x27;ll be important for understanding the subsequent extended topics.</p><p class="">In Dockerfiles, commands can be written in two forms:</p><ol type="1" class="numbered-list" start="1"><li>shell form<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Docker">RUN echo $HOME</code></pre></li></ol><ol type="1" class="numbered-list" start="2"><li><strong>exec</strong> form,  like array.join()<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Docker">ENTRYPOINT [&quot;echo&quot;, &quot;Hello&quot;]</code></pre><blockquote class="">The exec form is parsed as a JSON array, which means that you must use double-quotes (&quot;) around words, not single-quotes (&#x27;).<br/><br/><p class=""><a href="https://docs.docker.com/reference/dockerfile/">https://docs.docker.com/reference/dockerfile/</a></p></blockquote><p class="">Note: <code>docker exec</code> is unrelated to these forms. It&#x27;s used to execute commands inside a running container.</p></li></ol><p class=""><mark class="highlight-red"><code><strong>CMD</strong></code></mark><mark class="highlight-blue"><strong> &amp; </strong></mark><mark class="highlight-red"><code><strong>ENTRYPOINT</strong></code></mark><mark class="highlight-blue"><strong>  both support these two forms.</strong></mark></p><p class="">
</p><h1 class="">The Differences: CMD &amp; ENTRYPOINT</h1><ol type="1" class="numbered-list" start="1"><li>With ENTRYPOINT, CMD serves as a supplement:<p class=""><mark class="highlight-red"><strong>CMD is like a little brother</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Docker" style="white-space:pre-wrap;word-break:break-all">ENTRYPOINT [&quot;echo&quot;, &quot;Hello&quot;]
CMD [&quot;World&quot;]</code></pre><ul class="bulleted-list"><li style="list-style-type:disc"><code>docker run myimage</code> outputs &quot;Hello World”</li></ul><ul class="bulleted-list"><li style="list-style-type:disc"><code>docker run myimage Earth</code> outputs &quot;Hello Earth”</li></ul></li></ol><ol type="1" class="numbered-list" start="2"><li>Without ENTRYPOINT, CMD takes full control.</li></ol><ol type="1" class="numbered-list" start="3"><li>Only the last CMD instruction in a Dockerfile is effective.<blockquote class="">There can only be one <code>CMD</code> instruction in a Dockerfile. If you list more than one <code>CMD</code>, only the last one takes effect.<br/><br/><a href="https://docs.datadoghq.com/code_analysis/static_analysis_rules/docker-best-practices/multiple-cmd/">https://docs.datadoghq.com/code_analysis/static_analysis_rules/docker-best-practices/multiple-cmd/</a></blockquote></li></ol><p class="">
</p><p class="">
</p><h3 class="">Example: Using <code>ENTRYPOINT</code> and <code>CMD</code> Together</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Docker">FROM golang:1.22
WORKDIR /app
COPY . .
RUN go build -o main .
ENTRYPOINT [&quot;/bin/sh&quot;, &quot;-c&quot;]
CMD [&quot;echo default message &amp;&amp; ./main&quot;]</code></pre><p class="">Now we can have these situations to replace <code>CMD</code> and <code>ENTRYPOINT</code> step by step:</p><ol type="1" class="numbered-list" start="1"><li>This will just replace <code>CMD</code>, and <code>ENTRYPOINT</code> still works.<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">docker run -p 8080:8080 37faeaca8676 &quot;echo new message &amp;&amp; ./main&quot;
# Output:
# new message
# listening ....</code></pre></li></ol><ol type="1" class="numbered-list" start="2"><li>This overwrites both <code>ENTRYPOINT</code> and <code>CMD</code><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Bash">docker run -p 8080:8080 --entrypoint echo 37faeaca8676 &quot;nothing&quot;
# Output:
# nothing</code></pre></li></ol><p class="">
</p><p class="">Remember: <code>docker run</code> arguments after the image name replace <code>CMD</code>, while <code>--entrypoint</code> replaces ENTRYPOINT.</p><p class="">
</p><p class="">
</p><h1 class="">Best Practices: Exec Form vs. Shell Form</h1><p class="">It&#x27;s important to note that the examples of overriding <code>CMD</code> and <code>ENTRYPOINT</code> shown earlier are just demonstrations of how to override.</p><h3 class=""><strong>This is bad and a little complicated</strong></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Docker">ENTRYPOINT [&quot;/bin/sh&quot;, &quot;-c&quot;]
CMD [&quot;echo default message &amp;&amp; ./main&quot;]</code></pre><ol type="1" class="numbered-list" start="1"><li>When you start the container, <code>/bin/sh -c</code> becomes PID 1.</li></ol><ol type="1" class="numbered-list" start="2"><li>Your actual command (e.g., <code>&quot;echo default message &amp;&amp; ./main</code>&quot;) runs as a child process of <code>/bin/sh</code>.</li></ol><ol type="1" class="numbered-list" start="3"><li>When you try to stop the container (e.g., with Ctrl+C), the SIGINT signal is sent to PID 1 (<code>/bin/sh</code>). </li></ol><ol type="1" class="numbered-list" start="4"><li>Because in Unix/Linux systems, signals aren&#x27;t automatically propagated from parent to child processes. <mark class="highlight-red"><strong>shell with PID＝1</strong></mark> has special signal handling rules, and many signals are ignored by default unless explicitly handled.<blockquote class="">The reason for your problem is that <mark class="highlight-red"><strong>the kernel treats a process with PID 1 specially</strong></mark>, and does not, by default, kill the process when receiving the <code>SIGTERM</code> or <code>SIGINT</code> signals.<br/><br/><a href="https://stackoverflow.com/questions/60733727/unable-to-stop-my-docker-container-with-ctrl-c">https://stackoverflow.com/questions/60733727/unable-to-stop-my-docker-container-with-ctrl-c</a></blockquote><table class="simple-table"><tbody><tr><td class="">Aspect</td><td class="" style="width:127.99868774414062px">Normal PID 1</td><td class="">Shell as PID 1 (e.g., /bin/sh)</td></tr><tr><td class="">Receives signals</td><td class="" style="width:127.99868774414062px">🟢</td><td class="">🟢</td></tr><tr><td class="">Handles SIGTERM, SIGINT?</td><td class="" style="width:127.99868774414062px">Mostly if needed</td><td class="">Mostly ignores</td></tr><tr><td class="">Forwards signals to child</td><td class="" style="width:127.99868774414062px">N/A (usually no child processes)</td><td class="">❌</td></tr><tr><td class="">Default signal behavior</td><td class="" style="width:127.99868774414062px">it depends.</td><td class="">Ignores many signals</td></tr><tr><td class="">Good for container?</td><td class="" style="width:127.99868774414062px">🟢</td><td class="">❌, may need force stop</td></tr></tbody></table></li></ol><p class="">
</p><p class="">So </p><p class="">Let’s see the nuances of Dockerfile commands step by step. We&#x27;ll talk about the limitations and strengths of different approaches, moving from basic usage to best practices…</p><p class="">
</p><h3 class="">1. Limitation of Exec Form with Variable Expansion ☹️</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Docker">ENV name John Dow
ENTRYPOINT [&quot;/bin/echo&quot;, &quot;Hello, $name&quot;]</code></pre><p class="">In the exec form, <mark class="highlight-red"><strong>there&#x27;s no shell to interpret and expand variables</strong></mark><mark class="highlight-red">.</mark> The command is passed directly to the specified program without any variable substitution. As a result, this will literally output &quot;Hello, $name&quot; instead of &quot;Hello, John Doe&quot;.</p><h3 class="">2. The Problem with Shell Form 😐</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Docker">ENV name John Doe
ENTRYPOINT echo &quot;Hello, $name&quot;</code></pre><p class="">This can result in a situation where you&#x27;re trying to exit, but the <mark class="highlight-red"><strong>Docker container doesn&#x27;t respond as expected</strong></mark>. Because container running in child process cannot get <strong>SIGINT</strong> signal to stop.</p><p class="">
</p><h3 class="">3. The Better One: Exec Form with Bash 👍</h3><ol type="1" class="numbered-list" start="1"><li>Combines the benefits of exec form with shell variable parsing.<blockquote class="">If the -c option is present, then commands are read from string.</blockquote></li></ol><ol type="1" class="numbered-list" start="2"><li>Allows for proper signal handling, as your main process isn&#x27;t wrapped in a shell.</li></ol><ol type="1" class="numbered-list" start="3"><li>Ensures that variables are correctly expanded.</li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre class="code"><code class="language-Docker">ENV name John Doe
ENTRYPOINT [&quot;/bin/bash&quot;, &quot;-c&quot;, &quot;echo Hello, $name&quot;]</code></pre><p class="">
</p><p class="">
</p><p class="">
</p><p class="">
</p><h1 class="">References</h1><p class=""><a href="https://aws.amazon.com/blogs/opensource/demystifying-entrypoint-cmd-docker/">https://aws.amazon.com/blogs/opensource/demystifying-entrypoint-cmd-docker/</a></p><p class=""><a href="https://emmer.dev/blog/docker-shell-vs.-exec-form/">https://emmer.dev/blog/docker-shell-vs.-exec-form/</a></p><p class=""><a href="https://docs.docker.com/reference/dockerfile/">https://docs.docker.com/reference/dockerfile/</a></p><p class=""><a href="https://docs.datadoghq.com/code_analysis/static_analysis_rules/docker-best-practices/multiple-cmd/">https://docs.datadoghq.com/code_analysis/static_analysis_rules/docker-best-practices/multiple-cmd/</a></p><p class=""><a href="https://dev.to/kittipat1413/docker-run-vs-cmd-vs-entrypoint-demystifying-the-differences-2a4p">https://dev.to/kittipat1413/docker-run-vs-cmd-vs-entrypoint-demystifying-the-differences-2a4p</a></p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body>